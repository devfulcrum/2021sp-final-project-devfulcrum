

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Processing &mdash; 2021sp CSCI-E-20 Final Project - Covid and Vaccine Data Visualization 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualization" href="../visual/index.html" />
    <link rel="prev" title="Updates" href="../updates/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 2021sp CSCI-E-20 Final Project - Covid and Vaccine Data Visualization
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updates/index.html">Updates</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Processing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-data">Project Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-analysis">Data Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visual/index.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/index.html">Regression Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning/index.html">Continuous Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../future/index.html">Future State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">final_project</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">2021sp CSCI-E-20 Final Project - Covid and Vaccine Data Visualization</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Processing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/process/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="processing">
<h1>Processing<a class="headerlink" href="#processing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="project-data">
<h2>Project Data<a class="headerlink" href="#project-data" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Aggregated daily by Johns Hopkins University and published to GitHub repo</p></li>
<li><p>Data Files formats varies over time and based on the origin</p></li>
<li><p>Not all data files are available at the same</p></li>
<li><p>Run daily / nightly scheduled jobs to pull the data files</p></li>
<li><p>Download all the files for use, currently use covid cases and vaccination time series data</p></li>
<li><p>Transform the data for consistency and downstream use</p></li>
</ul>
</div>
<div class="section" id="data-analysis">
<h2>Data Analysis<a class="headerlink" href="#data-analysis" title="Permalink to this headline">¶</a></h2>
<p>The code analysis leverages both data files pull from GitHub repo, conduct analysis
transform the data for database load and then load the data to the database for
visualization and models execution</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">perform_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis_dataframe</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs actual computation of confirmed cases by country.</span>
<span class="sd">    Args:</span>
<span class="sd">        analysis_dataframe: Covid data</span>
<span class="sd">    Returns:</span>
<span class="sd">        dataframe that contains the calculated results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analysis_dataframe</span><span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_dataframe</span><span class="p">[</span><span class="s2">&quot;Country/Region&quot;</span><span class="p">]</span>
    <span class="n">analysis_dataframe</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_dataframe</span><span class="p">[</span>
        <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
            <span class="s2">&quot;%-m/</span><span class="si">%-d</span><span class="s2">/%y&quot;</span>
        <span class="p">)</span>
    <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">analysis_dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Country&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">Confirmed</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The data files require aggregation and transformation.  The confirmed covid cases daily information
is actually distributed across columns and requires a full pivot transformation aka melt of the numerical
data and store them by country and by day.  The below snippet of code helps accomplish the same.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">melt_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">melt_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Country/Region&quot;</span><span class="p">,</span> <span class="s2">&quot;Date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<p>Load the data to the database for visualization, below snippet of code runs via scheduled
job daily and helps with loading the data to covid_data table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
    <span class="n">covid_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">CovidData</span><span class="p">(</span>
            <span class="n">country</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">date</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">confirmed</span><span class="o">=</span><span class="n">records</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">records</span> <span class="ow">in</span> <span class="n">new3_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="n">CovidData</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="n">CovidData</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">bulk_create</span><span class="p">(</span><span class="n">covid_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../visual/index.html" class="btn btn-neutral float-right" title="Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../updates/index.html" class="btn btn-neutral float-left" title="Updates" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Muthu Venkataraman.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>